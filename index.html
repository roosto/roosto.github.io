<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript">
async function getClipboard() {
  return navigator.clipboard.readText();
}

function putInOutput(str) {
  console.log(str);
  document.getElementById('output').innerHTML = str;
}

function getDialInNumber() {
  return document.getElementById('zoom-number').value;
}

function isItZoomLink(str) {
  return RegExp('^https://.*zoom\\.us/.+/[0-9]+$').test(str);
}

async function doTheThing() {
  var cbText  = await getClipboard();
  cbText = cbText.trim();
  var cbDisplay = document.getElementById('cbDisplay');
  cbDisplay.value = cbText;
  if ( ! isItZoomLink(cbText) ) {
    alert('The below text does not look like a Zoom link');
    cbDisplay.focus();
    return;
  }
  
  var urlBits = cbText.split('/');
  console.log(urlBits);
  var zoomId  = urlBits[urlBits.length - 1];
  putInOutput('The ZoomID is ' + zoomId);

  var webLink       = document.getElementById('web-link');
  webLink.href      = cbText;
  webLink.innerHTML = cbText;

  var zoomNumber        = getDialInNumber();
  var dialinDisplay     = document.getElementById(zoomNumber).innerHTML + ' ,, ' + zoomNumber;
  var dialinLink        = document.getElementById('dial-in-link');
  dialinLink.href       = 'tel:+1' + zoomNumber + ',,' + zoomId + '#';
  dialinLink.innerHTML = dialinDisplay;
}

		</script>
		<title>Zoom Links to Dial-able Numbers</title>
	<head>
	<body>
		<h1>Zoom Links to Dial-able Numbers</h1>

		<label for='zoom-number'>
		<select id='zoom-number'>
			<option id='9292056099' value='9292056099'>+1 929.205.6099</option>
		</select><br />
		<button onclick='doTheThing()'>Grab from Clipboard</button><br />
		<hr />
		<p>Clipboard contents:</p>
		<textarea cols='120' rows='10' id='cbDisplay'></textarea><br />
		<p><a id='web-link' href=''></a></p> 
		<p><a id='dial-in-link' href=''></a></p>
		<div id='output' />
	</body>
</html>
